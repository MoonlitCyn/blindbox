<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>盲盒歌单（纯浏览器版）</title>
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
<div class="wrap">
  <h1>🎵 盲盒歌单（纯浏览器版）</h1>
  <div class="muted">
    在手机/平板/电脑的浏览器中直接运行。添加/删除歌曲，编号 1..N 开盲盒；每次洗牌都会打乱编号→歌名映射。数据仅保存在本机浏览器。
  </div>

  <!-- 歌曲池与控制 -->
  <div class="card">
    <div class="flex">
      <div class="pill">歌曲数：<span id="song-count" class="num">0</span></div>
      <div class="pill">最近洗牌：<span id="last-shuffle" class="num">—</span></div>
    </div>
    <div class="spacer"></div>
    <div class="row row-2">
      <div>
        <label for="pick-number">输入一个数字（1..N）开盲盒</label>
        <input id="pick-number" type="number" min="1" value="1" />
      </div>
      <div class="flex">
        <button id="btn-open" type="button">打开盲盒</button>
        <button id="btn-random" type="button" class="secondary">随机抽一首</button>
        <button id="btn-shuffle" type="button">重新洗牌</button>
      </div>
    </div>
    <div class="spacer"></div>
    <div id="result" class="success"></div>
  </div>

  <!-- 添加/删除 -->
  <div class="row row-2">
    <div class="card">
      <label for="single-title">添加单曲</label>
      <input id="single-title" type="text" placeholder="例如：周杰伦 - 晴天" />
      <div class="spacer"></div>
      <button id="btn-add-single" type="button">添加</button>
      <div class="spacer"></div>
      <div class="muted">会自动去重；不区分大小写。</div>
    </div>
    <div class="card">
      <label for="bulk-titles">批量添加（每行或用逗号分隔）</label>
      <textarea id="bulk-titles" placeholder="歌名A&#10;歌名B, 歌名C"></textarea>
      <div class="spacer"></div>
      <button id="btn-add-bulk" type="button">批量添加</button>
    </div>
  </div>

  <div class="card">
    <label for="delete-select">删除歌曲（可多选）</label>
    <select id="delete-select" multiple size="8" aria-label="删除歌曲列表"></select>
    <div class="spacer"></div>
    <button id="btn-delete" type="button" class="warn">删除所选</button>
  </div>

  <!-- 导入 / 导出 -->
  <div class="row row-2">
    <div class="card">
      <label>导出 JSON</label>
      <button id="btn-export" type="button" class="secondary">导出 songs.json</button>
      <div class="spacer"></div>
      <div class="muted">格式：<span class="kbd">{&quot;songs&quot;: [&quot;歌名1&quot;, ...]}</span> 或 <span class="kbd">[&quot;歌名1&quot;, ...]</span></div>
    </div>
    <div class="card">
      <label for="import-file">导入 JSON</label>
      <input id="import-file" type="file" accept="application/json" />
      <div class="spacer"></div>
      <div class="muted">导入会覆盖当前歌单（会自动转换为不重复列表）。</div>
    </div>
  </div>

  <div class="card">
    <details>
      <summary>使用说明</summary>
      <div class="hr"></div>
      <ul>
        <li>点击“重新洗牌”会随机打乱 <b>数字 1..N</b> 与 <b>歌名</b> 的对应关系，并记录时间。</li>
        <li>输入数字开盲盒；或点“随机抽一首”。</li>
        <li>数据保存在本机浏览器的 <code>localStorage</code>，也可导入/导出 JSON 文件。</li>
      </ul>
    </details>
  </div>
</div>

<!-- 使用内联 ES Module 导入，带版本参数防缓存；路径基于 index.html 所在位置 -->
<script type="module">
  // 如果 index.html 在仓库根目录，js/ 与之同层，保持下面这一行即可：
  import './js/app.js?v=6';
</script>

<!-- 兜底提示（仅用于排查：模块未加载/路径错误/使用 file:// 打开时会显示） -->
<script>
  setTimeout(() => {
    if (!window.__APP_LOADED__) {
      const el = document.getElementById('result');
      if (el) el.textContent = '⚠️ 前端脚本未加载：请不要用 file:// 打开。请用 http 服务（如 python -m http.server）或 GitHub Pages 访问，并检查 js/app.js 路径大小写。';
      console.warn('app.js 未设置 __APP_LOADED__，通常是模块未加载（路径/大小写/缓存/使用 file:// 打开导致）。');
    }
  }, 1200);
</script>
</body>
</html>
